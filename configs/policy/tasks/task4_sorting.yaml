# ==================== ä»»åŠ¡4ï¼šå…¨æµç¨‹åˆ†æ‹£ ====================

# ä»»åŠ¡åŸºæœ¬ä¿¡æ¯
task:
  id: 4
  name: 'sorting'
  stage: 4 # Stage 4: æœ€ç»ˆå¤šä»»åŠ¡æ¨¡å‹

  # ä»»åŠ¡æè¿°ï¼ˆä¸­æ–‡ï¼‰
  description: 'æœºå™¨äººä»æŒ‡å®šèµ·å§‹ç‚¹å‡ºå‘ï¼Œç§»åŠ¨è‡³æµåˆ©æ¶å‰æ‹¾å–å·¥ä»¶ï¼Œéšåè½¬èº«ç§»åŠ¨è‡³æ”¾ç½®æ¶ï¼Œå°†å·¥ä»¶æ”¾ç½®åœ¨ç‰©æ–™ç­å†…æŒ‡å®šä½ç½®'

  # Language Instructionï¼ˆè‹±æ–‡ï¼‰
  language_instruction: 'Move from the starting point to the rack, pick up the workpiece, turn around, move to the placement rack, and place it in the designated position in the material container'

  # æ•°æ®é…ç½®
  data:
    root: '/root/robot/data/task4/data/lerobot/1-400/'
    repoid: 'lerobot/task4_sorting'
    episodes_to_use: [0, 199]

  # è®­ç»ƒé…ç½®
  training:
    max_epoch: 35 # æœ€å¤æ‚ä»»åŠ¡ï¼Œæœ€å¤šepochs

    # Stage 4: ä»ä»»åŠ¡3çš„æœ€ä½³checkpointç»§ç»­
    # æ ¼å¼: outputs/train/{task}/{method}/run_{timestamp}/best
    # éœ€è¦æ‰‹åŠ¨æŒ‡å®šä»»åŠ¡3çš„timestampï¼
    resume_from: 'task'
    resume_task_id: 3
    resume_path: 'outputs/train/task3_placement/smolvla_sequential/run_XXXXXX_XXXXXX/best' # ä¿®æ”¹XXXXXXä¸ºå®é™…timestamp

    # æœ€ä½å­¦ä¹ ç‡ï¼ˆä¿æŒä¹‹å‰ä»»åŠ¡çŸ¥è¯†ï¼‰
    policy:
      optimizer_lr: 2e-5 # æœ€ä½å­¦ä¹ ç‡2e-5ï¼Œæœ€ç²¾ç»†è°ƒæ•´å¤šä»»åŠ¡æ¨¡å‹
      # åˆ†å±‚å­¦ä¹ ç‡
      vision_encoder_lr: 1.5e-6 # æœ€ä½çš„è§†è§‰ç¼–ç å™¨å­¦ä¹ ç‡ï¼ˆä»2e-6é™åˆ°1.5e-6ï¼‰
      expert_lr: 8e-6 # æœ€ä½çš„Action Expertå­¦ä¹ ç‡ï¼ˆä»1e-5é™åˆ°8e-6ï¼‰
      scheduler_warmup_steps: 300 # æœ€çŸ­warmupï¼Œå¿«é€Ÿé€‚åº”
      scheduler_decay_steps: 30000

      # ğŸ†• ä»»åŠ¡4æ¨èçš„è§†è§‰å±‚å†»ç»“ç­–ç•¥ï¼ˆæåº¦ä¿å®ˆï¼‰
      # ç›®æ ‡ï¼šæ•´åˆæ‰€æœ‰ä»»åŠ¡ï¼Œè·å¾—æœ€ç»ˆå¤šä»»åŠ¡æ¨¡å‹
      # ç­–ç•¥ï¼šåªè§£å†»æœ€å3å±‚ï¼ˆå¾®è°ƒæœ€é¡¶å±‚ï¼‰
      unfreeze_vision_layers: [-1, -2, -3] # è§£å†» Layer 24-26

      # ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªç­–ç•¥ï¼Ÿ
      # 1. æœ€åä¸€ä¸ªä»»åŠ¡ï¼Œç›®æ ‡æ˜¯æ•´åˆè€Œéå¤§å¹…æ”¹å˜æ¨¡å‹
      # 2. å‰3ä¸ªä»»åŠ¡å·²ç»å­¦ä¹ äº†ä¸°å¯Œçš„è§†è§‰ç‰¹å¾
      # 3. åˆ†æ‹£ä»»åŠ¡æ¶‰åŠ"ç§»åŠ¨+æŠ“å–+æ”¾ç½®"ï¼Œå‰é¢ä»»åŠ¡éƒ½æœ‰è¦†ç›–
      # 4. æåº¦ä¿å®ˆç­–ç•¥ç¡®ä¿å¤šä»»åŠ¡æ¨¡å‹çš„å¹³è¡¡æ€§

      # æ›¿ä»£ç­–ç•¥ï¼ˆå¦‚æœä»»åŠ¡4æ•ˆæœä¸ä½³ï¼‰:
      #
      # é€‰é¡¹1: ç¨å¾®æ”¾å®½ï¼ˆè§£å†»æœ€å5å±‚ï¼‰
      # unfreeze_vision_layers: [-1, -2, -3, -4, -5]
      #
      # é€‰é¡¹2: ä¸å†»ç»“è§†è§‰å±‚ï¼ˆä½†ä½¿ç”¨æä½å­¦ä¹ ç‡ï¼‰
      # unfreeze_vision_layers: null  # ä¸ä½¿ç”¨çµæ´»å†»ç»“ï¼Œä¾èµ–æä½å­¦ä¹ ç‡
      #
      # é€‰é¡¹3: å…¨éƒ¨å†»ç»“ï¼ˆåªè®­ç»ƒAction Expertå’Œå…¶ä»–æ¨¡å—ï¼‰
      # freeze_vision_encoder: True  # å®Œå…¨å†»ç»“è§†è§‰ç¼–ç å™¨

      # âš ï¸  è­¦å‘Šï¼šä»»åŠ¡4æ˜¯æœ€ç»ˆæ¨¡å‹ï¼Œå»ºè®®å¤šæ¬¡å®éªŒå¯¹æ¯”ä¸åŒç­–ç•¥çš„æ•ˆæœ

  # Replayé…ç½®ï¼ˆæœ€å¹³è¡¡çš„æ··åˆï¼‰
  replay:
    task1_episodes: 20 # 10% ä»»åŠ¡1
    task2_episodes: 20 # 10% ä»»åŠ¡2
    task3_episodes: 40 # 20% ä»»åŠ¡3
    # ä»»åŠ¡4å 60%ï¼ˆç”±è®­ç»ƒè„šæœ¬è‡ªåŠ¨è®¡ç®—ï¼‰
# ä»»åŠ¡4è®­ç»ƒå®Œæˆåï¼Œå°†è·å¾—æœ€ç»ˆçš„å¤šä»»åŠ¡æ¨¡å‹
# è¯¥æ¨¡å‹åº”è¯¥èƒ½å¤Ÿé€šè¿‡language instructionæ‰§è¡Œæ‰€æœ‰4ä¸ªä»»åŠ¡
