# åˆ†å±‚äººå½¢æœºå™¨äºº Diffusion Policy æ–‡æ¡£ä¸­å¿ƒ

> æ¬¢è¿ï¼è¿™é‡Œæ˜¯åˆ†å±‚æ¶æ„çš„å®Œæ•´æ–‡æ¡£ç´¢å¼•

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„æ–‡æ¡£

#### [1. åˆ†å±‚æ¶æ„è¯¦è§£ (ä¸»æ–‡æ¡£)](./hierarchical_policy_architecture.md)
**æ¨èé¦–å…ˆé˜…è¯»**

æ¶µç›–å†…å®¹:
- âœ… æ•´ä½“æ¶æ„è®¾è®¡ç†å¿µ
- âœ… è®­ç»ƒä¸»æµç¨‹è¯¦è§£
- âœ… å››å±‚æ¶æ„æ¦‚è¿°
- âœ… è¯¾ç¨‹å­¦ä¹ æœºåˆ¶
- âœ… ä»»åŠ¡ç‰¹å®šè®­ç»ƒ
- âœ… æ¨ç†é€»è¾‘
- âœ… é…ç½®ç³»ç»Ÿ
- âœ… å…³é”®è®¾è®¡å†³ç­–

**é€‚åˆäººç¾¤**: æ‰€æœ‰ç”¨æˆ·ï¼Œç‰¹åˆ«æ˜¯åˆæ¬¡ä½¿ç”¨è€…

**é˜…è¯»æ—¶é—´**: çº¦60åˆ†é’Ÿ

---

#### [2. å„å±‚è¯¦ç»†è®¾è®¡](./hierarchical_layers_detailed.md)
**æ·±å…¥ç†è§£å„å±‚å®ç°**

æ¶µç›–å†…å®¹:
- âœ… BaseLayer æŠ½è±¡åŸºç±»
- âœ… SafetyReflexLayer è¯¦ç»†è®¾è®¡ï¼ˆGRUæ¶æ„ã€ç´§æ€¥æ£€æµ‹ã€å€¾æ–œæ£€æµ‹ï¼‰
- âœ… GaitControlLayer è¯¦ç»†è®¾è®¡ï¼ˆæ··åˆGRU+Transformerã€æ­¥æ€å‘¨æœŸå»ºæ¨¡ï¼‰
- âœ… ManipulationLayer è¯¦ç»†è®¾è®¡ï¼ˆå¤šæ¨¡æ€èåˆã€çº¦æŸæ»¡è¶³ã€åŒè‡‚åè°ƒï¼‰
- âœ… GlobalPlanningLayer è¯¦ç»†è®¾è®¡ï¼ˆé•¿æœŸè®°å¿†ã€ä»»åŠ¡åˆ†è§£ï¼‰
- âœ… å±‚é—´é€šä¿¡æœºåˆ¶
- âœ… æŸå¤±å‡½æ•°è®¾è®¡

**é€‚åˆäººç¾¤**: éœ€è¦ä¿®æ”¹æˆ–æ‰©å±•å±‚åŠŸèƒ½çš„å¼€å‘è€…

**é˜…è¯»æ—¶é—´**: çº¦90åˆ†é’Ÿ

---

#### [3. æ•°æ®æµä¸å®æˆ˜æŒ‡å—](./hierarchical_dataflow_and_usage.md)
**å®é™…ä½¿ç”¨å’Œè°ƒè¯•**

æ¶µç›–å†…å®¹:
- âœ… å®Œæ•´æ•°æ®æµè¯¦è§£ï¼ˆä»æ•°æ®é›†åˆ°æŸå¤±ï¼‰
- âœ… è®­ç»ƒæ•°æ®æµ
- âœ… æ¨ç†æ•°æ®æµ
- âœ… å®æˆ˜ç¤ºä¾‹ï¼ˆè®­ç»ƒã€æ¢å¤è®­ç»ƒã€éƒ¨ç½²ï¼‰
- âœ… è°ƒè¯•æŠ€å·§
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å¸¸è§é—®é¢˜è§£ç­”

**é€‚åˆäººç¾¤**: å®é™…ä½¿ç”¨è¯¥ç³»ç»Ÿçš„ç ”ç©¶å‘˜å’Œå·¥ç¨‹å¸ˆ

**é˜…è¯»æ—¶é—´**: çº¦75åˆ†é’Ÿ

---

### ğŸ“Š å…¶ä»–æ–‡æ¡£

#### [4. Diffusionè®­ç»ƒåˆ†æ](./diffusion_training_analysis.md)
Diffusionæ¨¡å‹è®­ç»ƒçš„è¯¦ç»†åˆ†æ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–°ç”¨æˆ·æ¨èè·¯å¾„

```
1. é˜…è¯» [æ¶æ„è¯¦è§£] ç¬¬1-2èŠ‚
   â”œâ”€ äº†è§£æ•´ä½“è®¾è®¡
   â””â”€ ç†è§£å››å±‚æ¶æ„çš„èŒè´£

2. é˜…è¯» [æ•°æ®æµä¸å®æˆ˜] ç¬¬4èŠ‚
   â”œâ”€ å°è¯•è®­ç»ƒç¤ºä¾‹
   â””â”€ è¿è¡Œæ¨ç†ç¤ºä¾‹

3. æ·±å…¥é˜…è¯» [å„å±‚è¯¦ç»†è®¾è®¡]
   â””â”€ æ ¹æ®éœ€è¦æŸ¥é˜…ç‰¹å®šå±‚çš„å®ç°

4. é‡åˆ°é—®é¢˜æ—¶å‚è€ƒ [æ•°æ®æµä¸å®æˆ˜] ç¬¬7èŠ‚
   â””â”€ å¸¸è§é—®é¢˜è§£ç­”
```

### å¼€å‘è€…æ¨èè·¯å¾„

```
1. å¿«é€Ÿæµè§ˆ [æ¶æ„è¯¦è§£] å…¨æ–‡
   â””â”€ å»ºç«‹æ•´ä½“è®¤çŸ¥

2. æ·±å…¥é˜…è¯» [å„å±‚è¯¦ç»†è®¾è®¡]
   â”œâ”€ ç†è§£æ¯å±‚çš„ç½‘ç»œæ¶æ„
   â”œâ”€ ç†è§£æ¿€æ´»æ¡ä»¶
   â””â”€ ç†è§£æŸå¤±å‡½æ•°

3. å‚è€ƒ [æ•°æ®æµä¸å®æˆ˜] ç¬¬5èŠ‚
   â”œâ”€ å­¦ä¹ è°ƒè¯•æŠ€å·§
   â””â”€ å­¦ä¹ æ€§èƒ½ä¼˜åŒ–æ–¹æ³•

4. ä¿®æ”¹ä»£ç æ—¶æŸ¥é˜…ç›¸å…³ç« èŠ‚
```

---

## ğŸ“– æ–‡æ¡£ç»“æ„

```
docs/
â”œâ”€â”€ README.md (æœ¬æ–‡ä»¶)
â”‚   â””â”€ æ–‡æ¡£ç´¢å¼•å’Œå¯¼èˆª
â”‚
â”œâ”€â”€ hierarchical_policy_architecture.md
â”‚   â”œâ”€ 1. æ¶æ„æ¦‚è§ˆ
â”‚   â”œâ”€ 2. è®­ç»ƒä¸»æµç¨‹
â”‚   â”œâ”€ 3. åˆ†å±‚æ¶æ„è¯¦è§£
â”‚   â”œâ”€ 4. è¯¾ç¨‹å­¦ä¹ æœºåˆ¶
â”‚   â”œâ”€ 5. ä»»åŠ¡ç‰¹å®šè®­ç»ƒ
â”‚   â”œâ”€ 6. æ¨ç†é€»è¾‘
â”‚   â”œâ”€ 7. é…ç½®ç³»ç»Ÿ
â”‚   â””â”€ 8. å…³é”®è®¾è®¡å†³ç­–
â”‚
â”œâ”€â”€ hierarchical_layers_detailed.md
â”‚   â”œâ”€ 1. BaseLayer æŠ½è±¡åŸºç±»
â”‚   â”œâ”€ 2. SafetyReflexLayer è¯¦è§£
â”‚   â”œâ”€ 3. GaitControlLayer è¯¦è§£
â”‚   â”œâ”€ 4. ManipulationLayer è¯¦è§£
â”‚   â”œâ”€ 5. GlobalPlanningLayer è¯¦è§£
â”‚   â”œâ”€ 6. å±‚é—´é€šä¿¡æœºåˆ¶
â”‚   â””â”€ 7. æŸå¤±å‡½æ•°è®¾è®¡
â”‚
â””â”€â”€ hierarchical_dataflow_and_usage.md
    â”œâ”€ 1. å®Œæ•´æ•°æ®æµè¯¦è§£
    â”œâ”€ 2. è®­ç»ƒæ•°æ®æµ
    â”œâ”€ 3. æ¨ç†æ•°æ®æµ
    â”œâ”€ 4. å®æˆ˜ç¤ºä¾‹
    â”œâ”€ 5. è°ƒè¯•æŠ€å·§
    â”œâ”€ 6. æ€§èƒ½ä¼˜åŒ–
    â””â”€ 7. å¸¸è§é—®é¢˜
```

---

## ğŸ¯ æŒ‰ä»»åŠ¡æŸ¥æ‰¾

### æˆ‘æƒ³è¦...

#### è®­ç»ƒä¸€ä¸ªæ–°æ¨¡å‹
1. é˜…è¯» [æ¶æ„è¯¦è§£ - è®­ç»ƒä¸»æµç¨‹](./hierarchical_policy_architecture.md#2-è®­ç»ƒä¸»æµç¨‹)
2. å‚è€ƒ [å®æˆ˜æŒ‡å— - ä»é›¶å¼€å§‹è®­ç»ƒ](./hierarchical_dataflow_and_usage.md#41-ä»é›¶å¼€å§‹è®­ç»ƒ)
3. é…ç½® [è¯¾ç¨‹å­¦ä¹ ](./hierarchical_policy_architecture.md#4-è¯¾ç¨‹å­¦ä¹ æœºåˆ¶)

#### ç†è§£æŸä¸ªç‰¹å®šå±‚çš„å·¥ä½œåŸç†
1. é˜…è¯» [æ¶æ„è¯¦è§£ - åˆ†å±‚æ¶æ„è¯¦è§£](./hierarchical_policy_architecture.md#3-åˆ†å±‚æ¶æ„è¯¦è§£)
2. æ·±å…¥é˜…è¯» [å„å±‚è¯¦ç»†è®¾è®¡](./hierarchical_layers_detailed.md) çš„å¯¹åº”ç« èŠ‚

#### éƒ¨ç½²æ¨¡å‹åˆ°æœºå™¨äºº
1. é˜…è¯» [å®æˆ˜æŒ‡å— - éƒ¨ç½²åˆ°çœŸå®æœºå™¨äºº](./hierarchical_dataflow_and_usage.md#44-éƒ¨ç½²åˆ°çœŸå®æœºå™¨äºº)
2. äº†è§£ [æ¨ç†é€»è¾‘](./hierarchical_policy_architecture.md#6-æ¨ç†é€»è¾‘)
3. å­¦ä¹  [æ¨ç†æ¨¡å¼](./hierarchical_layers_detailed.md#614-æ¨ç†æ¨¡å¼-inference-mode)

#### è°ƒè¯•è®­ç»ƒé—®é¢˜
1. å‚è€ƒ [è°ƒè¯•æŠ€å·§](./hierarchical_dataflow_and_usage.md#5-è°ƒè¯•æŠ€å·§)
2. æŸ¥çœ‹ [å¸¸è§é—®é¢˜](./hierarchical_dataflow_and_usage.md#7-å¸¸è§é—®é¢˜)

#### ä¼˜åŒ–è®­ç»ƒé€Ÿåº¦æˆ–å†…å­˜
1. é˜…è¯» [æ€§èƒ½ä¼˜åŒ–](./hierarchical_dataflow_and_usage.md#6-æ€§èƒ½ä¼˜åŒ–)
2. äº†è§£ [é…ç½®ç³»ç»Ÿ](./hierarchical_policy_architecture.md#7-é…ç½®ç³»ç»Ÿ)

#### æ·»åŠ æ–°çš„å±‚æˆ–åŠŸèƒ½
1. ç†è§£ [BaseLayer æŠ½è±¡åŸºç±»](./hierarchical_layers_detailed.md#1-baselayer-æŠ½è±¡åŸºç±»)
2. å‚è€ƒç°æœ‰å±‚çš„å®ç°
3. äº†è§£ [å±‚é—´é€šä¿¡æœºåˆ¶](./hierarchical_layers_detailed.md#6-å±‚é—´é€šä¿¡æœºåˆ¶)

#### å¤šä»»åŠ¡è®­ç»ƒ
1. é˜…è¯» [ä»»åŠ¡ç‰¹å®šè®­ç»ƒ](./hierarchical_policy_architecture.md#5-ä»»åŠ¡ç‰¹å®šè®­ç»ƒ)
2. å‚è€ƒ [ä»»åŠ¡ç‰¹å®šè®­ç»ƒæ•°æ®æµ](./hierarchical_dataflow_and_usage.md#23-ä»»åŠ¡ç‰¹å®šè®­ç»ƒæ•°æ®æµ)

---

## ğŸ” å¿«é€ŸæŸ¥æ‰¾è¡¨

### å…³é”®æ¦‚å¿µ

| æ¦‚å¿µ | æ–‡æ¡£ä½ç½® | é¡µç  |
|---|---|---|
| åˆ†å±‚æ¶æ„æ€»è§ˆ | æ¶æ„è¯¦è§£ | ç¬¬1èŠ‚ |
| å››å±‚è®¾è®¡ç†å¿µ | æ¶æ„è¯¦è§£ | ç¬¬3èŠ‚ |
| SafetyReflexLayer | å„å±‚è¯¦ç»†è®¾è®¡ | ç¬¬2èŠ‚ |
| GaitControlLayer | å„å±‚è¯¦ç»†è®¾è®¡ | ç¬¬3èŠ‚ |
| ManipulationLayer | å„å±‚è¯¦ç»†è®¾è®¡ | ç¬¬4èŠ‚ |
| GlobalPlanningLayer | å„å±‚è¯¦ç»†è®¾è®¡ | ç¬¬5èŠ‚ |
| è¯¾ç¨‹å­¦ä¹  | æ¶æ„è¯¦è§£ | ç¬¬4èŠ‚ |
| ä»»åŠ¡ç‰¹å®šè®­ç»ƒ | æ¶æ„è¯¦è§£ | ç¬¬5èŠ‚ |
| æ•°æ®æµ | æ•°æ®æµä¸å®æˆ˜ | ç¬¬1èŠ‚ |
| è®­ç»ƒç¤ºä¾‹ | æ•°æ®æµä¸å®æˆ˜ | ç¬¬4èŠ‚ |
| è°ƒè¯•æŠ€å·§ | æ•°æ®æµä¸å®æˆ˜ | ç¬¬5èŠ‚ |
| æ€§èƒ½ä¼˜åŒ– | æ•°æ®æµä¸å®æˆ˜ | ç¬¬6èŠ‚ |
| å¸¸è§é—®é¢˜ | æ•°æ®æµä¸å®æˆ˜ | ç¬¬7èŠ‚ |

### ä»£ç ä½ç½®

| ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ |
|---|---|
| è®­ç»ƒä¸»è„šæœ¬ | `kuavo_train/train_hierarchical_policy.py` |
| Policyä¸»ç±» | `kuavo_train/wrapper/policy/humanoid/HumanoidDiffusionPolicy.py` |
| è°ƒåº¦å™¨ | `kuavo_train/wrapper/policy/humanoid/HierarchicalScheduler.py` |
| SafetyLayer | `kuavo_train/wrapper/policy/humanoid/layers/SafetyReflexLayer.py` |
| GaitLayer | `kuavo_train/wrapper/policy/humanoid/layers/GaitControlLayer.py` |
| ManipulationLayer | `kuavo_train/wrapper/policy/humanoid/layers/ManipulationLayer.py` |
| PlanningLayer | `kuavo_train/wrapper/policy/humanoid/layers/GlobalPlanningLayer.py` |
| ä»»åŠ¡ç®¡ç†å™¨ | `kuavo_train/wrapper/policy/humanoid/TaskSpecificTrainingManager.py` |
| é…ç½®æ–‡ä»¶ | `configs/policy/humanoid_diffusion_config.yaml` |

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-10-10 - æ–‡æ¡£v1.0å‘å¸ƒ
- âœ… å®Œæˆä¸»æ¶æ„æ–‡æ¡£
- âœ… å®Œæˆå„å±‚è¯¦ç»†è®¾è®¡æ–‡æ¡£
- âœ… å®Œæˆæ•°æ®æµä¸å®æˆ˜æŒ‡å—
- âœ… åˆ›å»ºæ–‡æ¡£ç´¢å¼•

---

## ğŸ¤ è´¡çŒ®

å¦‚æœæ‚¨å‘ç°æ–‡æ¡£ä¸­çš„é”™è¯¯æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. åœ¨é¡¹ç›®ä¸­æIssue
2. æˆ–ç›´æ¥ä¿®æ”¹æ–‡æ¡£å¹¶æäº¤PR

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- é¡¹ç›®ä¸»README: [../README.md](../README.md)
- è®­ç»ƒæ—¥å¿—: `hierarchical_training.log`
- TensorBoard: `tensorboard --logdir outputs/train/`

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

